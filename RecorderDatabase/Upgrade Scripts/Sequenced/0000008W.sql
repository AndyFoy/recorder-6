/*===========================================================================
Description: 
Modifications to the reporting in Recorder 6:
    Including Surveyor’s Ref as a field to filter on when filtering species observations in the observation hierarchy
    Including Event and Sample Top-level location as attributes in the report wizard - uses a UDF
    Including metadata as attributes in the report wizard
    Adding Confidential, Verified and Zero Abundance to Available Fields for Conditions
    Including Sample Easting and Sample Northing as attributes in the report wizard 
    Including Sample 100 m Square, Sample 10 m Square and Sample Tetrad as attributes in the report wizard
    Including Kingdom, Phylum, Class, Order and Family as an attribute in the report wizard
    Including Recommended Common Name/Taxon Group as an attribute in the report wizard
    Including Recommended Taxon Name without Sub-genus as an attribute in the report wizard 
Parameters: -
User Defined Functions required: LCLocationTopParent
	LCReturnEastingsV2 and LCReturnNorthingsV2 
	LCReturn100mSq, LCReturn10mSq and LCReturnTetrad
	LCReturnHierarchy
	LCReturnLocalName and LCRemoveSubGenusText
System Views required: LC_DATE_FILTER and LC_DATE_FILTER_CHANGED
Created: 
	26/11/2012
  Author: Sally Rankin /Mike Weideli
=========================================================================== */
/****** Modify Report Attributes to stop fields which relate only to Taxon Occurrence appearing when the Biotope is selected ******/


-- General settings
SET DATEFORMAT ymd


Update Report_Attribute Set Item_Group = 'Taxon\Observations\Association' where Report_Attribute_Key IN ('JNCCDEV100000013','JNCCDEV100000012','JNCCDEV100000011')

Update Report_Attribute Set Item_Group = 'Taxon\Observations\Determination' where Report_Attribute_Key IN ('JNCCDEV100000007','NBNSYS0000000063','JNCCDEV100000008','JNCCDEV100000009','JNCCDEV100000010')


Update Report_Attribute Set Item_Group = 'Taxon\Observations' where Report_Attribute_Key IN ('NBNSYS0000000057','NBNSYS0000000064','NBNSYS0000000065'
,'NBNSYS0000000056','NBNSYS0000000055','NBNSYS0000000054','NBNSYS0000000053','NBNSYS0000000052','JNCCDEV100000014','JNCCDEV100000006','JNCCDEV100000004')

/****** Including Surveyor’s Ref as a field to filter on when filtering species observations in the observation hierarchy: ******/

Update USABLE_FIELD Set APPLY_TO = 'F' 
Where TABLE_NAME = 'TAXON_OCCURRENCE' and FIELD_NAME = 'SURVEYORS_REF'

GO

Update USABLE_FIELD Set CALCULATION_SQL =
'SELECT TXO.Taxon_Occurrence_Key AS ItemKey FROM Taxon_Occurrence TXO WHERE TXO.SURVEYORS_REF'
Where TABLE_NAME = 'TAXON_OCCURRENCE' and FIELD_NAME = 'SURVEYORS_REF'

GO

/****** Including Event and Sample Top-level location as attributes in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000001') and REPORT_FIELD_KEY = 'SRA0000400000001'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000001') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000001'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000001', 'Event', 'SURVEY_EVENT', 'Event Top-level Location', 
'#REPORT_OUTPUT.[Event Top-level Location] = dbo.LCLocationTopParent(LOCATION.LOCATION_KEY, 0)', 
'NBNSYS0000000005', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000001', 'SRA0000400000001', 'Event Top-level Location', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000002') and REPORT_FIELD_KEY = 'SRA0000400000002'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000002') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000002'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000002', 'Sample\Location', 'SAMPLE', 'Sample Top-level Location', 
'#REPORT_OUTPUT.[Sample Top-level Location] = dbo.LCLocationTopParent(LOCATION.LOCATION_KEY, 0)', 
'NBNSYS0000000009', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000002', 'SRA0000400000002', 'Sample Top-level Location', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Taxon Occurrence Key ******/

Update RA Set RA.ITEM_GROUP = 'Taxon\Observation Metadata', RA.CHANGED_BY = 'TESTDATA00000001', RA.CHANGED_DATE = GetDate()
From REPORT_ATTRIBUTE RA Where RA.REPORT_ATTRIBUTE_KEY = 'JNCCDEV100000001'

GO

Delete From USABLE_FIELD 
Where Exists (Select * From USABLE_FIELD Where USABLE_FIELD_KEY = 'SRA0000400000003') and USABLE_FIELD_KEY = 'SRA0000400000003'

GO

Insert Into USABLE_FIELD
Values ('SRA0000400000003', 'TAXON_OCCURRENCE', 'TAXON_OCCURRENCE_KEY', 'Obs Key', 'TEXT', 'T', 1, 1, 1, 'TAXON_OCCURRENCE.TAXON_OCCURRENCE_KEY')

GO
/****** Metadata: Taxon Occurrence Entry Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000004') and REPORT_FIELD_KEY = 'SRA0000400000004'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000004') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000004'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000004', 'Taxon\Observation Metadata', 'TAXON_OCCURRENCE', 'Obs Entry Date', 
'#REPORT_OUTPUT.[Obs Entry Date] = TAXON_OCCURRENCE.ENTRY_DATE', 
'NBNSYS0000000016', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000004', 'SRA0000400000004', 'Obs Entry Date', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

DELETE FROM USABLE_TABLE
WHERE EXISTS(SELECT * FROM USABLE_TABLE WHERE USABLE_TABLE_KEY = 'SRA0000400000004') AND USABLE_TABLE_KEY = 'SRA0000400000004'
DELETE FROM USABLE_FIELD
WHERE EXISTS(SELECT * FROM USABLE_FIELD WHERE USABLE_FIELD_KEY = 'SRA0000400000004') AND USABLE_FIELD_KEY = 'SRA0000400000004'

GO

INSERT INTO USABLE_TABLE(USABLE_TABLE_KEY,TABLE_NAME,LINK_TABLE,LINK,APPLY_TO,JOIN_ORDER)
VALUES ('SRA0000400000004', 'LC_DATE_FILTER','Taxon_Occurrence',
'LC_DATE_FILTER.Taxon_Occurrence_Key = Taxon_Occurrence.Taxon_Occurrence_Key','T',8)
INSERT INTO USABLE_FIELD(USABLE_FIELD_KEY,TABLE_NAME,FIELD_NAME,FIELD_DESCRIPTION,
FIELD_TYPE,APPLY_TO,SELECTABLE,SORTABLE,FILTERABLE,CALCULATION_SQL)
VALUES ('SRA0000400000004','LC_DATE_FILTER','DATESTRING','Obs Entry Date(yyyymmdd)',
'NUMBER','T',0,0,1,'LC_DATE_FILTER.DATESTRING')

GO

/****** Metadata: Taxon Occurrence Changed Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000005') and REPORT_FIELD_KEY = 'SRA0000400000005'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000005') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000005'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000005', 'Taxon\Observation Metadata', 'TAXON_OCCURRENCE', 'Obs Changed Date', 
'#REPORT_OUTPUT.[Obs Changed Date] = TAXON_OCCURRENCE.CHANGED_DATE', 
'NBNSYS0000000016', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000005', 'SRA0000400000005', 'Obs Changed Date', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

DELETE FROM USABLE_TABLE 
WHERE EXISTS(SELECT * FROM USABLE_TABLE WHERE USABLE_TABLE_KEY = 'SRA0000400000005') AND USABLE_TABLE_KEY = 'SRA0000400000005' 
DELETE FROM USABLE_FIELD
WHERE EXISTS(SELECT * FROM USABLE_FIELD WHERE USABLE_FIELD_KEY = 'SRA0000400000005') AND USABLE_FIELD_KEY = 'SRA0000400000005' 

GO

INSERT INTO USABLE_TABLE(USABLE_TABLE_KEY,TABLE_NAME,LINK_TABLE,LINK,APPLY_TO,JOIN_ORDER)
VALUES ('SRA0000400000005', 'LC_DATE_FILTER_CHANGED','Taxon_Occurrence',
'LC_DATE_FILTER_CHANGED.Taxon_Occurrence_Key = Taxon_Occurrence.Taxon_Occurrence_Key',
'T',8)
INSERT INTO USABLE_FIELD(USABLE_FIELD_KEY,TABLE_NAME,FIELD_NAME,FIELD_DESCRIPTION,
FIELD_TYPE,APPLY_TO,SELECTABLE,SORTABLE,FILTERABLE,CALCULATION_SQL)
VALUES ('SRA0000400000005','LC_DATE_FILTER_CHANGED','DATESTRING','Obs Changed Date(yyyymmdd)',
'NUMBER','T',0,0,1,'LC_DATE_FILTER_CHANGED.DATESTRING')

GO

/****** Metadata: Survey Key ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000006') and REPORT_FIELD_KEY = 'SRA0000400000006'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000006') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000006'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000006', 'Metadata', 'SURVEY', 'Survey Key', 
'#REPORT_OUTPUT.[Survey Key] = SURVEY.SURVEY_KEY', 
'NBNSYS0000000000', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000006', 'SRA0000400000006', 'Survey Key', 'varchar', 16, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO
/****** Metadata: Survey Entry Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000007') and REPORT_FIELD_KEY = 'SRA0000400000007'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000007') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000007'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000007', 'Metadata', 'SURVEY', 'Survey Entry Date', 
'#REPORT_OUTPUT.[Survey Entry Date] = SURVEY.ENTRY_DATE', 
'NBNSYS0000000000', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000007', 'SRA0000400000007', 'Survey Entry Date', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Survey Changed Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000008') and REPORT_FIELD_KEY = 'SRA0000400000008'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000008') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000008'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000008', 'Metadata', 'SURVEY', 'Survey Changed Date', 
'#REPORT_OUTPUT.[Survey Changed Date] = SURVEY.CHANGED_DATE', 
'NBNSYS0000000000', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000008', 'SRA0000400000008', 'Survey Changed Date ', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO
/****** Metadata: Event Key ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000009') and REPORT_FIELD_KEY = 'SRA0000400000009'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000009') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000009'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000009', 'Metadata', 'SURVEY_EVENT', 'Event Key', 
'#REPORT_OUTPUT.[Event Key] = SURVEY_EVENT.SURVEY_EVENT_KEY', 
'NBNSYS0000000004', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000009', 'SRA0000400000009', 'Event Key', 'varchar', 16, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Event Entry Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000010') and REPORT_FIELD_KEY = 'SRA0000400000010'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000010') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000010'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000010', 'Metadata', 'SURVEY_EVENT', 'Event Entry Date', 
'#REPORT_OUTPUT.[Event Entry Date] = SURVEY_EVENT.ENTRY_DATE', 
'NBNSYS0000000004', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000010', 'SRA0000400000010', 'Event Entry Date ', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Event Changed Date ******/


Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000011') and REPORT_FIELD_KEY = 'SRA0000400000011'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000011') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000011'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000011', 'Metadata', 'SURVEY_EVENT', 'Event Changed Date', 
'#REPORT_OUTPUT.[Event Changed Date] = SURVEY_EVENT.CHANGED_DATE', 
'NBNSYS0000000004', NULL, 'TESTDATA00000001', '2012-08-29 17:22:00', NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000011', 'SRA0000400000011', 'Event Changed Date ', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Sample Key ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000012') and REPORT_FIELD_KEY = 'SRA0000400000012'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000012') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000012'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000012', 'Metadata', 'SAMPLE', 'Sample Key', 
'#REPORT_OUTPUT.[Sample Key] = SAMPLE.SAMPLE_KEY', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001', '2012-08-29 17:24:00', NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000012', 'SRA0000400000012', 'Sample Key', 'varchar', 16, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Sample Entry Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000013') and REPORT_FIELD_KEY = 'SRA0000400000013'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000013') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000013'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000013', 'Metadata', 'SAMPLE', 'Sample Entry Date', 
'#REPORT_OUTPUT.[Sample Entry Date] = SAMPLE.ENTRY_DATE', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001',GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000013', 'SRA0000400000013', 'Sample Entry Date ', 'smalldatetime', NULL, 
'TESTDATA00000001',GetDate(), NULL, NULL, 1)

GO

/****** Metadata: Sample Changed Date ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000014') and REPORT_FIELD_KEY = 'SRA0000400000014'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000014') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000014'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000014', 'Metadata', 'SAMPLE', 'Sample Changed Date', 
'#REPORT_OUTPUT.[Sample Changed Date] = SAMPLE.CHANGED_DATE', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000014', 'SRA0000400000014', 'Sample Changed Date ', 'smalldatetime', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Adding Confidential, Verified and Zero Abundance to Available Fields for Conditions:  ******/


Delete From USABLE_FIELD 
Where Exists (Select * From USABLE_FIELD Where USABLE_FIELD_KEY = 'SRA0000400000015') and USABLE_FIELD_KEY = 'SRA0000400000015'

GO

Insert Into USABLE_FIELD
Values ('SRA0000400000015', 'TAXON_OCCURRENCE', 'CONFIDENTIAL', 'Obs Confidential', 'BOOLEAN', 'T', 1, 1, 1, 'TAXON_OCCURRENCE.CONFIDENTIAL')

GO

Update USABLE_FIELD Set FILTERABLE = 1 
Where TABLE_NAME = 'TAXON_OCCURRENCE' and FIELD_NAME = 'VERIFIED'

GO

Update USABLE_FIELD Set FIELD_NAME = 'ZERO_ABUNDANCE', FILTERABLE = 1 
Where TABLE_NAME = 'TAXON_OCCURRENCE' and FIELD_NAME = 'ZER_ABUNDANCE'

GO

/****** Including Sample Easting SW Corner as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'LC00000100000102') and REPORT_FIELD_KEY = 'LC00000100000102'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'LC00000100000102') and REPORT_ATTRIBUTE_KEY = 'LC00000100000102'

GO

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000016') and REPORT_FIELD_KEY = 'SRA0000400000016'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000016') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000016'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000016', 'Sample', 'SAMPLE', 'Sample Easting SW Corner', 
'#REPORT_OUTPUT.[Sample Easting SW Corner] = dbo.LCReturnEastingsV2(SAMPLE.SPATIAL_REF,SAMPLE.SPATIAL_REF_SYSTEM,0)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001',GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000016', 'SRA0000400000016', 'Sample Easting SW Corner', 'Integer', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Sample Easting Centre as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'LC00000100000104') and REPORT_FIELD_KEY = 'LC00000100000104'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'LC00000100000104') and REPORT_ATTRIBUTE_KEY = 'LC00000100000104'

GO

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000017') and REPORT_FIELD_KEY = 'SRA0000400000017'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000017') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000017'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000017', 'Sample', 'SAMPLE', 'Sample Easting Centre', 
'#REPORT_OUTPUT.[Sample Easting Centre] = dbo.LCReturnEastingsV2(SAMPLE.SPATIAL_REF,SAMPLE.SPATIAL_REF_SYSTEM,1)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000017', 'SRA0000400000017', 'Sample Easting Centre', 'Integer', NULL, 
'TESTDATA00000001',GetDate(), NULL, NULL, 1)

GO

/****** Including Sample Northing SW Corner as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'LC00000100000103') and REPORT_FIELD_KEY = 'LC00000100000103'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'LC00000100000103') and REPORT_ATTRIBUTE_KEY = 'LC00000100000103'

GO

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000018') and REPORT_FIELD_KEY = 'SRA0000400000018'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000018') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000018'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000018', 'Sample', 'SAMPLE', 'Sample Northing SW Corner', 
'#REPORT_OUTPUT.[Sample Northing SW Corner] = dbo.LCReturnNorthingsV2(SAMPLE.SPATIAL_REF,SAMPLE.SPATIAL_REF_SYSTEM,0)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000018', 'SRA0000400000018', 'Sample Northing SW Corner', 'Integer', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Sample Northing Centre as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'LC00000100000105') and REPORT_FIELD_KEY = 'LC00000100000105'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'LC00000100000105') and REPORT_ATTRIBUTE_KEY = 'LC00000100000105'

GO

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000019') and REPORT_FIELD_KEY = 'SRA0000400000019'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000019') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000019'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000019', 'Sample', 'SAMPLE', 'Sample Northing Centre', 
'#REPORT_OUTPUT.[Sample Northing Centre] = dbo.LCReturnNorthingsV2(SAMPLE.SPATIAL_REF,SAMPLE.SPATIAL_REF_SYSTEM,1)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001',GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000019', 'SRA0000400000019', 'Sample Northing Centre', 'Integer', NULL, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Sample 100 m Square as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000020') and REPORT_FIELD_KEY = 'SRA0000400000020'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000020') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000020'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000020', 'Sample\Grid square', 'SAMPLE', 'Sample 100 m Square', 
'#REPORT_OUTPUT.[Sample 100 m Square] = dbo.LCReturn100mSq(SPATIAL_REF, SPATIAL_REF_SYSTEM, 0)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000020', 'SRA0000400000020', 'Sample 100 m Square', 'varchar', 8, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Sample 10 m Square as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000021') and REPORT_FIELD_KEY = 'SRA0000400000021'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000021') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000021'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000021', 'Sample\Grid square', 'SAMPLE', 'Sample 10 m Square', 
'#REPORT_OUTPUT.[Sample 10 m Square] = dbo.LCReturn10mSq(SPATIAL_REF, SPATIAL_REF_SYSTEM, 0)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001',GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000021', 'SRA0000400000021', 'Sample 10 m Square', 'varchar', 10, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Sample Tetrad as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000022') and REPORT_FIELD_KEY = 'SRA0000400000022'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000022') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000022'

GO

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000022', 'Sample\Grid square', 'SAMPLE', 'Sample Tetrad', 
'#REPORT_OUTPUT.[Sample Tetrad] = dbo.LCReturnTetrad(SPATIAL_REF,SPATIAL_REF_SYSTEM)', 
'NBNSYS0000000007', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000022', 'SRA0000400000022', 'Sample Tetrad', 'varchar', 5, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Kingdom as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000023') and REPORT_FIELD_KEY = 'SRA0000400000023'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000023') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000023'
Delete From REPORT_JOIN WHERE REPORT_JOIN_KEY = 'SRA0000400000032'

GO

INSERT INTO REPORT_JOIN 
Values ('SRA0000400000032', 'FROM #REPORT_OUTPUT LEFT JOIN INDEX_TAXON_NAME ITN ON ITN.TAXON_LIST_ITEM_KEY=#REPORT_OUTPUT.LIST_ITEM_KEY AND ITN.SYSTEM_SUPPLIED_DATA=1
INNER JOIN TAXON_LIST_ITEM TLI ON ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.TAXON_LIST_ITEM_KEY INNER JOIN INDEX_TAXON_HIERARCHY
ITH ON ITH.RECOMMENDED_TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY INNER JOIN TAXON_VERSION TV ON TV.TAXON_VERSION_KEY = 
ITH.HIERARCHY_TAXON_VERSION_KEY AND ITH.Hierarchy_Type = ''K'' INNER JOIN TAXON T ON T.TAXON_KEY = TV.TAXON_KEY',
'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000023', 'Taxon', 'TAXON_DETERMINATION', 'Taxon Kingdom', 
'#REPORT_OUTPUT.[Taxon Kingdom] = T.Item_Name', 
'SRA0000400000032', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000023', 'SRA0000400000023', 'Taxon Kingdom', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Phylum as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000024') and REPORT_FIELD_KEY = 'SRA0000400000024'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000024') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000024'
Delete From REPORT_JOIN WHERE REPORT_JOIN_KEY = 'SRA0000400000031'

GO
INSERT INTO REPORT_JOIN 
Values ('SRA0000400000031', 'FROM #REPORT_OUTPUT LEFT JOIN INDEX_TAXON_NAME ITN ON ITN.TAXON_LIST_ITEM_KEY=#REPORT_OUTPUT.LIST_ITEM_KEY AND ITN.SYSTEM_SUPPLIED_DATA=1
INNER JOIN TAXON_LIST_ITEM TLI ON ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.TAXON_LIST_ITEM_KEY INNER JOIN INDEX_TAXON_HIERARCHY
ITH ON ITH.RECOMMENDED_TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY INNER JOIN TAXON_VERSION TV ON TV.TAXON_VERSION_KEY =
ITH.HIERARCHY_TAXON_VERSION_KEY AND ITH.Hierarchy_Type = ''P'' INNER JOIN TAXON T ON T.TAXON_KEY = TV.TAXON_KEY',
'TESTDATA00000001', GetDate(),  NULL, NULL, 1)
Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000024', 'Taxon', 'TAXON_DETERMINATION', 'Taxon Phylum', 
'#REPORT_OUTPUT.[Taxon Phylum] = T.Item_Name', 
'SRA0000400000031', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000024', 'SRA0000400000024', 'Taxon Phylum', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Class as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000025') and REPORT_FIELD_KEY = 'SRA0000400000025'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000025') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000025'
Delete From REPORT_JOIN WHERE REPORT_JOIN_KEY = 'SRA0000400000030'
GO
INSERT INTO REPORT_JOIN 
Values ('SRA0000400000030', 'FROM #REPORT_OUTPUT LEFT JOIN INDEX_TAXON_NAME ITN ON ITN.TAXON_LIST_ITEM_KEY=#REPORT_OUTPUT.LIST_ITEM_KEY AND ITN.SYSTEM_SUPPLIED_DATA=1
INNER JOIN TAXON_LIST_ITEM TLI ON ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.TAXON_LIST_ITEM_KEY INNER JOIN INDEX_TAXON_HIERARCHY
ITH ON ITH.RECOMMENDED_TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY INNER JOIN TAXON_VERSION TV ON TV.TAXON_VERSION_KEY =
ITH.HIERARCHY_TAXON_VERSION_KEY AND ITH.Hierarchy_Type = ''C'' INNER JOIN TAXON T ON T.TAXON_KEY = TV.TAXON_KEY',
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000025', 'Taxon', 'TAXON_DETERMINATION', 'Taxon Class', 
'#REPORT_OUTPUT.[Taxon Class] = T.Item_Name', 
'SRA0000400000030', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000025', 'SRA0000400000025', 'Taxon Class', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Order as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000026') and REPORT_FIELD_KEY = 'SRA0000400000026'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000026') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000026'
Delete From REPORT_JOIN WHERE REPORT_JOIN_KEY = 'SRA0000400000029'
GO

INSERT INTO REPORT_JOIN 
Values ('SRA0000400000029', 'FROM #REPORT_OUTPUT LEFT JOIN INDEX_TAXON_NAME ITN ON ITN.TAXON_LIST_ITEM_KEY=#REPORT_OUTPUT.LIST_ITEM_KEY AND ITN.SYSTEM_SUPPLIED_DATA=1
INNER JOIN TAXON_LIST_ITEM TLI ON ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.TAXON_LIST_ITEM_KEY INNER JOIN INDEX_TAXON_HIERARCHY
ITH ON ITH.RECOMMENDED_TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY INNER JOIN TAXON_VERSION TV ON TV.TAXON_VERSION_KEY =
ITH.HIERARCHY_TAXON_VERSION_KEY AND ITH.Hierarchy_Type = ''O'' INNER JOIN TAXON T ON T.TAXON_KEY = TV.TAXON_KEY',
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000026', 'Taxon', 'TAXON_DETERMINATION', 'Taxon Order', 
'#REPORT_OUTPUT.[Taxon Order] = T.Item_Name', 
'SRA0000400000029', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000026', 'SRA0000400000026', 'Taxon Order', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Family as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000027') and REPORT_FIELD_KEY = 'SRA0000400000027'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000027') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000027'
Delete From REPORT_JOIN WHERE REPORT_JOIN_KEY = 'SRA0000400000028'
GO
INSERT INTO REPORT_JOIN 
Values ('SRA0000400000028', 'FROM #REPORT_OUTPUT LEFT JOIN INDEX_TAXON_NAME ITN ON ITN.TAXON_LIST_ITEM_KEY=#REPORT_OUTPUT.LIST_ITEM_KEY AND ITN.SYSTEM_SUPPLIED_DATA=1
INNER JOIN TAXON_LIST_ITEM TLI ON ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.TAXON_LIST_ITEM_KEY INNER JOIN INDEX_TAXON_HIERARCHY
ITH ON ITH.RECOMMENDED_TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY INNER JOIN TAXON_VERSION TV ON TV.TAXON_VERSION_KEY =
ITH.HIERARCHY_TAXON_VERSION_KEY AND ITH.Hierarchy_Type = ''F'' INNER JOIN TAXON T ON T.TAXON_KEY = TV.TAXON_KEY',
'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000027', 'Taxon', 'TAXON_DETERMINATION', 'Taxon Family', 
'#REPORT_OUTPUT.[Taxon Family]  = T.Item_Name', 
'SRA0000400000028', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000027', 'SRA0000400000027', 'Taxon Family', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Recommended Common Name/Taxon Group as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000028') and REPORT_FIELD_KEY = 'SRA0000400000028'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000028') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000028'

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000028', 'Taxon', 'TAXON_DETERMINATION', 'Recommended Common Name/Taxon Group', 
'#REPORT_OUTPUT.[Recommended Common Name/Taxon Group] = dbo.LCReturnLocalName(TAXON_LIST_ITEM_KEY)', 
'NBNSYS0000000027', NULL, 'TESTDATA00000001', GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000028', 'SRA0000400000028', 'Recommended Common Name/Taxon Group', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)

GO

/****** Including Recommended Taxon Name without Sub-genus as an attribute in the report wizard: ******/

Delete From REPORT_FIELD 
Where Exists (Select * From REPORT_FIELD Where REPORT_FIELD_KEY = 'SRA0000400000029') and REPORT_FIELD_KEY = 'SRA0000400000029'
Delete From REPORT_ATTRIBUTE
Where Exists (Select * From REPORT_ATTRIBUTE Where REPORT_ATTRIBUTE_KEY = 'SRA0000400000029') and REPORT_ATTRIBUTE_KEY = 'SRA0000400000029'

Insert Into REPORT_ATTRIBUTE
Values ('SRA0000400000029', 'Taxon', 'TAXON_DETERMINATION', 'Recommended Taxon Name without Sub-genus', 
'#REPORT_OUTPUT.[Recommended Taxon Name without Sub-genus] = dbo.LCRemoveSubGenusText(INDEX_TAXON_NAME.PREFERRED_NAME)', 
'NBNSYS0000000039', NULL, 'TESTDATA00000001',GetDate(), NULL, NULL, 1)
Insert Into REPORT_FIELD
Values ('SRA0000400000029', 'SRA0000400000029', 'Recommended Taxon Name without Sub-genus', 'varchar', 100, 
'TESTDATA00000001', GetDate(), NULL, NULL, 1)