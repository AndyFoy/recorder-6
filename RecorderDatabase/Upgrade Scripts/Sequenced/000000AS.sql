/****** Changes associated with searching on Preferred  ******/

ALTER TABLE TAXON_LIST
ADD PRIORITY Int

GO

UPDATE TAXON_LIST SET PRIORITY = 250 WHERE TAXON_LIST_KEY = 'BMSSYS0000000001'
UPDATE TAXON_LIST SET PRIORITY = 8090 WHERE TAXON_LIST_KEY = 'EHSSYS0000000001'
UPDATE TAXON_LIST SET PRIORITY = 8100 WHERE TAXON_LIST_KEY = 'EHSSYS0000000002'
UPDATE TAXON_LIST SET PRIORITY = 0 WHERE TAXON_LIST_KEY = 'LC00000100000001'
UPDATE TAXON_LIST SET PRIORITY = 8370 WHERE TAXON_LIST_KEY = 'NBNSYS0000000001'
UPDATE TAXON_LIST SET PRIORITY = 8380 WHERE TAXON_LIST_KEY = 'NBNSYS0000000002'
UPDATE TAXON_LIST SET PRIORITY = 8390 WHERE TAXON_LIST_KEY = 'NBNSYS0000000003'
UPDATE TAXON_LIST SET PRIORITY = 8400 WHERE TAXON_LIST_KEY = 'NBNSYS0000000004'
UPDATE TAXON_LIST SET PRIORITY = 8410 WHERE TAXON_LIST_KEY = 'NBNSYS0000000005'
UPDATE TAXON_LIST SET PRIORITY = 8420 WHERE TAXON_LIST_KEY = 'NBNSYS0000000006'
UPDATE TAXON_LIST SET PRIORITY = 8430 WHERE TAXON_LIST_KEY = 'NBNSYS0000000007'
UPDATE TAXON_LIST SET PRIORITY = 8440 WHERE TAXON_LIST_KEY = 'NBNSYS0000000008'
UPDATE TAXON_LIST SET PRIORITY = 8045 WHERE TAXON_LIST_KEY = 'NBNSYS0000000009'
UPDATE TAXON_LIST SET PRIORITY = 8046 WHERE TAXON_LIST_KEY = 'NBNSYS0000000010'
UPDATE TAXON_LIST SET PRIORITY = 8050 WHERE TAXON_LIST_KEY = 'NBNSYS0000000011'
UPDATE TAXON_LIST SET PRIORITY = 8070 WHERE TAXON_LIST_KEY = 'NBNSYS0000000012'
UPDATE TAXON_LIST SET PRIORITY = 8080 WHERE TAXON_LIST_KEY = 'NBNSYS0000000013'
UPDATE TAXON_LIST SET PRIORITY = 8042 WHERE TAXON_LIST_KEY = 'NBNSYS0000000014'
UPDATE TAXON_LIST SET PRIORITY = 8043 WHERE TAXON_LIST_KEY = 'NBNSYS0000000015'
UPDATE TAXON_LIST SET PRIORITY = 8044 WHERE TAXON_LIST_KEY = 'NBNSYS0000000016'
UPDATE TAXON_LIST SET PRIORITY = 8030 WHERE TAXON_LIST_KEY = 'NBNSYS0000000017'
UPDATE TAXON_LIST SET PRIORITY = 8040 WHERE TAXON_LIST_KEY = 'NBNSYS0000000018'
UPDATE TAXON_LIST SET PRIORITY = 8041 WHERE TAXON_LIST_KEY = 'NBNSYS0000000019'
UPDATE TAXON_LIST SET PRIORITY = 8260 WHERE TAXON_LIST_KEY = 'NBNSYS0000000020'
UPDATE TAXON_LIST SET PRIORITY = 8290 WHERE TAXON_LIST_KEY = 'NBNSYS0000000021'
UPDATE TAXON_LIST SET PRIORITY = 8300 WHERE TAXON_LIST_KEY = 'NBNSYS0000000022'
UPDATE TAXON_LIST SET PRIORITY = 8270 WHERE TAXON_LIST_KEY = 'NBNSYS0000000023'
UPDATE TAXON_LIST SET PRIORITY = 8320 WHERE TAXON_LIST_KEY = 'NBNSYS0000000024'
UPDATE TAXON_LIST SET PRIORITY = 8280 WHERE TAXON_LIST_KEY = 'NBNSYS0000000025'
UPDATE TAXON_LIST SET PRIORITY = 4020 WHERE TAXON_LIST_KEY = 'NBNSYS0000000026'
UPDATE TAXON_LIST SET PRIORITY = 4030 WHERE TAXON_LIST_KEY = 'NBNSYS0000000027'
UPDATE TAXON_LIST SET PRIORITY = 740 WHERE TAXON_LIST_KEY = 'NBNSYS0000000028'
UPDATE TAXON_LIST SET PRIORITY = 750 WHERE TAXON_LIST_KEY = 'NBNSYS0000000029'
UPDATE TAXON_LIST SET PRIORITY = 2000 WHERE TAXON_LIST_KEY = 'NBNSYS0000000030'
UPDATE TAXON_LIST SET PRIORITY = 4040 WHERE TAXON_LIST_KEY = 'NBNSYS0000000031'
UPDATE TAXON_LIST SET PRIORITY = 760 WHERE TAXON_LIST_KEY = 'NBNSYS0000000032'
UPDATE TAXON_LIST SET PRIORITY = 4050 WHERE TAXON_LIST_KEY = 'NBNSYS0000000033'
UPDATE TAXON_LIST SET PRIORITY = 4060 WHERE TAXON_LIST_KEY = 'NBNSYS0000000034'
UPDATE TAXON_LIST SET PRIORITY = 2060 WHERE TAXON_LIST_KEY = 'NBNSYS0000000035'
UPDATE TAXON_LIST SET PRIORITY = 2070 WHERE TAXON_LIST_KEY = 'NBNSYS0000000036'
UPDATE TAXON_LIST SET PRIORITY = 2080 WHERE TAXON_LIST_KEY = 'NBNSYS0000000037'
UPDATE TAXON_LIST SET PRIORITY = 2090 WHERE TAXON_LIST_KEY = 'NBNSYS0000000038'
UPDATE TAXON_LIST SET PRIORITY = 2100 WHERE TAXON_LIST_KEY = 'NBNSYS0000000039'
UPDATE TAXON_LIST SET PRIORITY = 2110 WHERE TAXON_LIST_KEY = 'NBNSYS0000000040'
UPDATE TAXON_LIST SET PRIORITY = 2120 WHERE TAXON_LIST_KEY = 'NBNSYS0000000041'
UPDATE TAXON_LIST SET PRIORITY = 2130 WHERE TAXON_LIST_KEY = 'NBNSYS0000000042'
UPDATE TAXON_LIST SET PRIORITY = 2140 WHERE TAXON_LIST_KEY = 'NBNSYS0000000043'
UPDATE TAXON_LIST SET PRIORITY = 2150 WHERE TAXON_LIST_KEY = 'NBNSYS0000000044'
UPDATE TAXON_LIST SET PRIORITY = 2160 WHERE TAXON_LIST_KEY = 'NBNSYS0000000045'
UPDATE TAXON_LIST SET PRIORITY = 2170 WHERE TAXON_LIST_KEY = 'NBNSYS0000000046'
UPDATE TAXON_LIST SET PRIORITY = 2180 WHERE TAXON_LIST_KEY = 'NBNSYS0000000047'
UPDATE TAXON_LIST SET PRIORITY = 2190 WHERE TAXON_LIST_KEY = 'NBNSYS0000000048'
UPDATE TAXON_LIST SET PRIORITY = 2200 WHERE TAXON_LIST_KEY = 'NBNSYS0000000049'
UPDATE TAXON_LIST SET PRIORITY = 2210 WHERE TAXON_LIST_KEY = 'NBNSYS0000000050'
UPDATE TAXON_LIST SET PRIORITY = 2220 WHERE TAXON_LIST_KEY = 'NBNSYS0000000051'
UPDATE TAXON_LIST SET PRIORITY = 2230 WHERE TAXON_LIST_KEY = 'NBNSYS0000000052'
UPDATE TAXON_LIST SET PRIORITY = 2240 WHERE TAXON_LIST_KEY = 'NBNSYS0000000053'
UPDATE TAXON_LIST SET PRIORITY = 2250 WHERE TAXON_LIST_KEY = 'NBNSYS0000000054'
UPDATE TAXON_LIST SET PRIORITY = 2260 WHERE TAXON_LIST_KEY = 'NBNSYS0000000055'
UPDATE TAXON_LIST SET PRIORITY = 2270 WHERE TAXON_LIST_KEY = 'NBNSYS0000000056'
UPDATE TAXON_LIST SET PRIORITY = 2280 WHERE TAXON_LIST_KEY = 'NBNSYS0000000057'
UPDATE TAXON_LIST SET PRIORITY = 2290 WHERE TAXON_LIST_KEY = 'NBNSYS0000000058'
UPDATE TAXON_LIST SET PRIORITY = 2300 WHERE TAXON_LIST_KEY = 'NBNSYS0000000059'
UPDATE TAXON_LIST SET PRIORITY = 2310 WHERE TAXON_LIST_KEY = 'NBNSYS0000000060'
UPDATE TAXON_LIST SET PRIORITY = 2320 WHERE TAXON_LIST_KEY = 'NBNSYS0000000061'
UPDATE TAXON_LIST SET PRIORITY = 2330 WHERE TAXON_LIST_KEY = 'NBNSYS0000000062'
UPDATE TAXON_LIST SET PRIORITY = 2340 WHERE TAXON_LIST_KEY = 'NBNSYS0000000063'
UPDATE TAXON_LIST SET PRIORITY = 2350 WHERE TAXON_LIST_KEY = 'NBNSYS0000000064'
UPDATE TAXON_LIST SET PRIORITY = 2360 WHERE TAXON_LIST_KEY = 'NBNSYS0000000065'
UPDATE TAXON_LIST SET PRIORITY = 2370 WHERE TAXON_LIST_KEY = 'NBNSYS0000000066'
UPDATE TAXON_LIST SET PRIORITY = 2380 WHERE TAXON_LIST_KEY = 'NBNSYS0000000067'
UPDATE TAXON_LIST SET PRIORITY = 2390 WHERE TAXON_LIST_KEY = 'NBNSYS0000000068'
UPDATE TAXON_LIST SET PRIORITY = 2400 WHERE TAXON_LIST_KEY = 'NBNSYS0000000069'
UPDATE TAXON_LIST SET PRIORITY = 2410 WHERE TAXON_LIST_KEY = 'NBNSYS0000000070'
UPDATE TAXON_LIST SET PRIORITY = 2420 WHERE TAXON_LIST_KEY = 'NBNSYS0000000071'
UPDATE TAXON_LIST SET PRIORITY = 2430 WHERE TAXON_LIST_KEY = 'NBNSYS0000000072'
UPDATE TAXON_LIST SET PRIORITY = 2440 WHERE TAXON_LIST_KEY = 'NBNSYS0000000073'
UPDATE TAXON_LIST SET PRIORITY = 1010 WHERE TAXON_LIST_KEY = 'NBNSYS0000000074'
UPDATE TAXON_LIST SET PRIORITY = 6050 WHERE TAXON_LIST_KEY = 'NBNSYS0000000075'
UPDATE TAXON_LIST SET PRIORITY = 6100 WHERE TAXON_LIST_KEY = 'NBNSYS0000000076'
UPDATE TAXON_LIST SET PRIORITY = 6010 WHERE TAXON_LIST_KEY = 'NBNSYS0000000077'
UPDATE TAXON_LIST SET PRIORITY = 6020 WHERE TAXON_LIST_KEY = 'NBNSYS0000000078'
UPDATE TAXON_LIST SET PRIORITY = 6000 WHERE TAXON_LIST_KEY = 'NBNSYS0000000079'
UPDATE TAXON_LIST SET PRIORITY = 6060 WHERE TAXON_LIST_KEY = 'NBNSYS0000000080'
UPDATE TAXON_LIST SET PRIORITY = 6070 WHERE TAXON_LIST_KEY = 'NBNSYS0000000081'
UPDATE TAXON_LIST SET PRIORITY = 6140 WHERE TAXON_LIST_KEY = 'NBNSYS0000000082'
UPDATE TAXON_LIST SET PRIORITY = 6120 WHERE TAXON_LIST_KEY = 'NBNSYS0000000083'
UPDATE TAXON_LIST SET PRIORITY = 6040 WHERE TAXON_LIST_KEY = 'NBNSYS0000000084'
UPDATE TAXON_LIST SET PRIORITY = 6130 WHERE TAXON_LIST_KEY = 'NBNSYS0000000085'
UPDATE TAXON_LIST SET PRIORITY = 6090 WHERE TAXON_LIST_KEY = 'NBNSYS0000000086'
UPDATE TAXON_LIST SET PRIORITY = 6030 WHERE TAXON_LIST_KEY = 'NBNSYS0000000087'
UPDATE TAXON_LIST SET PRIORITY = 620 WHERE TAXON_LIST_KEY = 'NBNSYS0000000088'
UPDATE TAXON_LIST SET PRIORITY = 6080 WHERE TAXON_LIST_KEY = 'NBNSYS0000000089'
UPDATE TAXON_LIST SET PRIORITY = 4070 WHERE TAXON_LIST_KEY = 'NBNSYS0000000090'
UPDATE TAXON_LIST SET PRIORITY = 6220 WHERE TAXON_LIST_KEY = 'NBNSYS0000000091'
UPDATE TAXON_LIST SET PRIORITY = 8060 WHERE TAXON_LIST_KEY = 'NBNSYS0000000092'
UPDATE TAXON_LIST SET PRIORITY = 6330 WHERE TAXON_LIST_KEY = 'NBNSYS0000000093'
UPDATE TAXON_LIST SET PRIORITY = 4080 WHERE TAXON_LIST_KEY = 'NBNSYS0000000094'
UPDATE TAXON_LIST SET PRIORITY = 4090 WHERE TAXON_LIST_KEY = 'NBNSYS0000000095'
UPDATE TAXON_LIST SET PRIORITY = 4199 WHERE TAXON_LIST_KEY = 'NBNSYS0000000096'
UPDATE TAXON_LIST SET PRIORITY = 4200 WHERE TAXON_LIST_KEY = 'NBNSYS0000000097'
UPDATE TAXON_LIST SET PRIORITY = 4210 WHERE TAXON_LIST_KEY = 'NBNSYS0000000098'
UPDATE TAXON_LIST SET PRIORITY = 8360 WHERE TAXON_LIST_KEY = 'NBNSYS0000000099'
UPDATE TAXON_LIST SET PRIORITY = 8047 WHERE TAXON_LIST_KEY = 'NBNSYS0000000100'
UPDATE TAXON_LIST SET PRIORITY = 8020 WHERE TAXON_LIST_KEY = 'NBNSYS0000000101'
UPDATE TAXON_LIST SET PRIORITY = 8180 WHERE TAXON_LIST_KEY = 'NBNSYS0000000102'
UPDATE TAXON_LIST SET PRIORITY = 8010 WHERE TAXON_LIST_KEY = 'NBNSYS0000000103'
UPDATE TAXON_LIST SET PRIORITY = 8200 WHERE TAXON_LIST_KEY = 'NBNSYS0000000104'
UPDATE TAXON_LIST SET PRIORITY = 3000 WHERE TAXON_LIST_KEY = 'NBNSYS0000000106'
UPDATE TAXON_LIST SET PRIORITY = 3010 WHERE TAXON_LIST_KEY = 'NBNSYS0000000107'
UPDATE TAXON_LIST SET PRIORITY = 3020 WHERE TAXON_LIST_KEY = 'NBNSYS0000000108'
UPDATE TAXON_LIST SET PRIORITY = 3030 WHERE TAXON_LIST_KEY = 'NBNSYS0000000109'
UPDATE TAXON_LIST SET PRIORITY = 3040 WHERE TAXON_LIST_KEY = 'NBNSYS0000000110'
UPDATE TAXON_LIST SET PRIORITY = 3050 WHERE TAXON_LIST_KEY = 'NBNSYS0000000111'
UPDATE TAXON_LIST SET PRIORITY = 6250 WHERE TAXON_LIST_KEY = 'NBNSYS0000000112'
UPDATE TAXON_LIST SET PRIORITY = 8048 WHERE TAXON_LIST_KEY = 'NBNSYS0000000113'
UPDATE TAXON_LIST SET PRIORITY = 8049 WHERE TAXON_LIST_KEY = 'NBNSYS0000000114'
UPDATE TAXON_LIST SET PRIORITY = 8230 WHERE TAXON_LIST_KEY = 'NBNSYS0000000115'
UPDATE TAXON_LIST SET PRIORITY = 1020 WHERE TAXON_LIST_KEY = 'NBNSYS0000000116'
UPDATE TAXON_LIST SET PRIORITY = 4010 WHERE TAXON_LIST_KEY = 'NBNSYS0000000117'
UPDATE TAXON_LIST SET PRIORITY = 2010 WHERE TAXON_LIST_KEY = 'NBNSYS0000000118'
UPDATE TAXON_LIST SET PRIORITY = 2020 WHERE TAXON_LIST_KEY = 'NBNSYS0000000119'
UPDATE TAXON_LIST SET PRIORITY = 2040 WHERE TAXON_LIST_KEY = 'NBNSYS0000000120'
UPDATE TAXON_LIST SET PRIORITY = 2050 WHERE TAXON_LIST_KEY = 'NBNSYS0000000121'
UPDATE TAXON_LIST SET PRIORITY = 2030 WHERE TAXON_LIST_KEY = 'NBNSYS0000000122'
UPDATE TAXON_LIST SET PRIORITY = 8170 WHERE TAXON_LIST_KEY = 'NBNSYS0000000124'
UPDATE TAXON_LIST SET PRIORITY = 6160 WHERE TAXON_LIST_KEY = 'NBNSYS0000000126'
UPDATE TAXON_LIST SET PRIORITY = 4220 WHERE TAXON_LIST_KEY = 'NBNSYS0100000001'
UPDATE TAXON_LIST SET PRIORITY = 8310 WHERE TAXON_LIST_KEY = 'NBNSYS0100000002'
UPDATE TAXON_LIST SET PRIORITY = 4230 WHERE TAXON_LIST_KEY = 'NBNSYS0100000003'
UPDATE TAXON_LIST SET PRIORITY = 4240 WHERE TAXON_LIST_KEY = 'NBNSYS0100000005'
UPDATE TAXON_LIST SET PRIORITY = 190 WHERE TAXON_LIST_KEY = 'NBNSYS0100000006'
UPDATE TAXON_LIST SET PRIORITY = 8000 WHERE TAXON_LIST_KEY = 'NBNSYS0200000001'
UPDATE TAXON_LIST SET PRIORITY = 6150 WHERE TAXON_LIST_KEY = 'NBNSYS0500000001'
UPDATE TAXON_LIST SET PRIORITY = 9996 WHERE TAXON_LIST_KEY = 'NHMFC10020191871'
UPDATE TAXON_LIST SET PRIORITY = 210 WHERE TAXON_LIST_KEY = 'NHMSYS0000066916'
UPDATE TAXON_LIST SET PRIORITY = 240 WHERE TAXON_LIST_KEY = 'NHMSYS0000066918'
UPDATE TAXON_LIST SET PRIORITY = 610 WHERE TAXON_LIST_KEY = 'NHMSYS0000066920'
UPDATE TAXON_LIST SET PRIORITY = 110 WHERE TAXON_LIST_KEY = 'NHMSYS0000066922'
UPDATE TAXON_LIST SET PRIORITY = 380 WHERE TAXON_LIST_KEY = 'NHMSYS0000066924'
UPDATE TAXON_LIST SET PRIORITY = 280 WHERE TAXON_LIST_KEY = 'NHMSYS0000066926'
UPDATE TAXON_LIST SET PRIORITY = 460 WHERE TAXON_LIST_KEY = 'NHMSYS0000301720'
UPDATE TAXON_LIST SET PRIORITY = 470 WHERE TAXON_LIST_KEY = 'NHMSYS0000303673'
UPDATE TAXON_LIST SET PRIORITY = 130 WHERE TAXON_LIST_KEY = 'NHMSYS0000303790'
UPDATE TAXON_LIST SET PRIORITY = 90 WHERE TAXON_LIST_KEY = 'NHMSYS0000306008'
UPDATE TAXON_LIST SET PRIORITY = 310 WHERE TAXON_LIST_KEY = 'NHMSYS0000315619'
UPDATE TAXON_LIST SET PRIORITY = 340 WHERE TAXON_LIST_KEY = 'NHMSYS0000315878'
UPDATE TAXON_LIST SET PRIORITY = 4250 WHERE TAXON_LIST_KEY = 'NHMSYS0000315917'
UPDATE TAXON_LIST SET PRIORITY = 4260 WHERE TAXON_LIST_KEY = 'NHMSYS0000317227'
UPDATE TAXON_LIST SET PRIORITY = 200 WHERE TAXON_LIST_KEY = 'NHMSYS0000317415'
UPDATE TAXON_LIST SET PRIORITY = 4270 WHERE TAXON_LIST_KEY = 'NHMSYS0000317613'
UPDATE TAXON_LIST SET PRIORITY = 4280 WHERE TAXON_LIST_KEY = 'NHMSYS0000318461'
UPDATE TAXON_LIST SET PRIORITY = 510 WHERE TAXON_LIST_KEY = 'NHMSYS0000319016'
UPDATE TAXON_LIST SET PRIORITY = 100 WHERE TAXON_LIST_KEY = 'NHMSYS0000319417'
UPDATE TAXON_LIST SET PRIORITY = 160 WHERE TAXON_LIST_KEY = 'NHMSYS0000321732'
UPDATE TAXON_LIST SET PRIORITY = 4290 WHERE TAXON_LIST_KEY = 'NHMSYS0000321741'
UPDATE TAXON_LIST SET PRIORITY = 4300 WHERE TAXON_LIST_KEY = 'NHMSYS0000323384'
UPDATE TAXON_LIST SET PRIORITY = 4310 WHERE TAXON_LIST_KEY = 'NHMSYS0000328310'
UPDATE TAXON_LIST SET PRIORITY = 4320 WHERE TAXON_LIST_KEY = 'NHMSYS0000330367'
UPDATE TAXON_LIST SET PRIORITY = 520 WHERE TAXON_LIST_KEY = 'NHMSYS0000332286'
UPDATE TAXON_LIST SET PRIORITY = 50 WHERE TAXON_LIST_KEY = 'NHMSYS0000332392'
UPDATE TAXON_LIST SET PRIORITY = 350 WHERE TAXON_LIST_KEY = 'NHMSYS0000332462'
UPDATE TAXON_LIST SET PRIORITY = 400 WHERE TAXON_LIST_KEY = 'NHMSYS0000343946'
UPDATE TAXON_LIST SET PRIORITY = 60 WHERE TAXON_LIST_KEY = 'NHMSYS0000353092'
UPDATE TAXON_LIST SET PRIORITY = 630 WHERE TAXON_LIST_KEY = 'NHMSYS0000354793'
UPDATE TAXON_LIST SET PRIORITY = 4330 WHERE TAXON_LIST_KEY = 'NHMSYS0000354845'
UPDATE TAXON_LIST SET PRIORITY = 1000 WHERE TAXON_LIST_KEY = 'NHMSYS0000355953'
UPDATE TAXON_LIST SET PRIORITY = 170 WHERE TAXON_LIST_KEY = 'NHMSYS0000356016'
UPDATE TAXON_LIST SET PRIORITY = 490 WHERE TAXON_LIST_KEY = 'NHMSYS0000356589'
UPDATE TAXON_LIST SET PRIORITY = 245 WHERE TAXON_LIST_KEY = 'NHMSYS0000357024'
UPDATE TAXON_LIST SET PRIORITY = 640 WHERE TAXON_LIST_KEY = 'NHMSYS0000436459'
UPDATE TAXON_LIST SET PRIORITY = 1030 WHERE TAXON_LIST_KEY = 'NHMSYS0000495044'
UPDATE TAXON_LIST SET PRIORITY = 4340 WHERE TAXON_LIST_KEY = 'NHMSYS0000527393'
UPDATE TAXON_LIST SET PRIORITY = 4350 WHERE TAXON_LIST_KEY = 'NHMSYS0000527885'
UPDATE TAXON_LIST SET PRIORITY = 80 WHERE TAXON_LIST_KEY = 'NHMSYS0000528629'
UPDATE TAXON_LIST SET PRIORITY = 220 WHERE TAXON_LIST_KEY = 'NHMSYS0000544284'
UPDATE TAXON_LIST SET PRIORITY = 230 WHERE TAXON_LIST_KEY = 'NHMSYS0000545686'
UPDATE TAXON_LIST SET PRIORITY = 360 WHERE TAXON_LIST_KEY = 'NHMSYS0000546432'
UPDATE TAXON_LIST SET PRIORITY = 440 WHERE TAXON_LIST_KEY = 'NHMSYS0000546994'
UPDATE TAXON_LIST SET PRIORITY = 540 WHERE TAXON_LIST_KEY = 'NHMSYS0000566638'
UPDATE TAXON_LIST SET PRIORITY = 120 WHERE TAXON_LIST_KEY = 'NHMSYS0000570416'
UPDATE TAXON_LIST SET PRIORITY = 40 WHERE TAXON_LIST_KEY = 'NHMSYS0000591449'
UPDATE TAXON_LIST SET PRIORITY = 500 WHERE TAXON_LIST_KEY = 'NHMSYS0000629198'
UPDATE TAXON_LIST SET PRIORITY = 4360 WHERE TAXON_LIST_KEY = 'NHMSYS0000863705'
UPDATE TAXON_LIST SET PRIORITY = 140 WHERE TAXON_LIST_KEY = 'NHMSYS0000867109'
UPDATE TAXON_LIST SET PRIORITY = 390 WHERE TAXON_LIST_KEY = 'NHMSYS0000869396'
UPDATE TAXON_LIST SET PRIORITY = 30 WHERE TAXON_LIST_KEY = 'NHMSYS0000871304'
UPDATE TAXON_LIST SET PRIORITY = 430 WHERE TAXON_LIST_KEY = 'NHMSYS0000883969'
UPDATE TAXON_LIST SET PRIORITY = 600 WHERE TAXON_LIST_KEY = 'NHMSYS0000884893'
UPDATE TAXON_LIST SET PRIORITY = 290 WHERE TAXON_LIST_KEY = 'NHMSYS0000886770'
UPDATE TAXON_LIST SET PRIORITY = 530 WHERE TAXON_LIST_KEY = 'NHMSYS0000923479'
UPDATE TAXON_LIST SET PRIORITY = 180 WHERE TAXON_LIST_KEY = 'NHMSYS0001385948'
UPDATE TAXON_LIST SET PRIORITY = 480 WHERE TAXON_LIST_KEY = 'NHMSYS0001386055'
UPDATE TAXON_LIST SET PRIORITY = 590 WHERE TAXON_LIST_KEY = 'NHMSYS0001386308'
UPDATE TAXON_LIST SET PRIORITY = 420 WHERE TAXON_LIST_KEY = 'NHMSYS0001386663'
UPDATE TAXON_LIST SET PRIORITY = 560 WHERE TAXON_LIST_KEY = 'NHMSYS0001389108'
UPDATE TAXON_LIST SET PRIORITY = 410 WHERE TAXON_LIST_KEY = 'NHMSYS0001590614'
UPDATE TAXON_LIST SET PRIORITY = 150 WHERE TAXON_LIST_KEY = 'NHMSYS0001591231'
UPDATE TAXON_LIST SET PRIORITY = 4370 WHERE TAXON_LIST_KEY = 'NHMSYS0001682672'
UPDATE TAXON_LIST SET PRIORITY = 4380 WHERE TAXON_LIST_KEY = 'NHMSYS0001688402'
UPDATE TAXON_LIST SET PRIORITY = 550 WHERE TAXON_LIST_KEY = 'NHMSYS0001691097'
UPDATE TAXON_LIST SET PRIORITY = 260 WHERE TAXON_LIST_KEY = 'NHMSYS0001699644'
UPDATE TAXON_LIST SET PRIORITY = 370 WHERE TAXON_LIST_KEY = 'NHMSYS0001700910'
UPDATE TAXON_LIST SET PRIORITY = 70 WHERE TAXON_LIST_KEY = 'NHMSYS0001706440'
UPDATE TAXON_LIST SET PRIORITY = 4390 WHERE TAXON_LIST_KEY = 'NHMSYS0001749171'
UPDATE TAXON_LIST SET PRIORITY = 4400 WHERE TAXON_LIST_KEY = 'NHMSYS0001770462'
UPDATE TAXON_LIST SET PRIORITY = 4410 WHERE TAXON_LIST_KEY = 'NHMSYS0001770825'
UPDATE TAXON_LIST SET PRIORITY = 8340 WHERE TAXON_LIST_KEY = 'NHMSYS0019998127'
UPDATE TAXON_LIST SET PRIORITY = 8350 WHERE TAXON_LIST_KEY = 'NHMSYS0020170854'
UPDATE TAXON_LIST SET PRIORITY = 10 WHERE TAXON_LIST_KEY = 'NHMSYS0020189627'
UPDATE TAXON_LIST SET PRIORITY = 300 WHERE TAXON_LIST_KEY = 'NHMSYS0020302447'
UPDATE TAXON_LIST SET PRIORITY = 580 WHERE TAXON_LIST_KEY = 'NHMSYS0020304427'
UPDATE TAXON_LIST SET PRIORITY = 270 WHERE TAXON_LIST_KEY = 'NHMSYS0020306640'
UPDATE TAXON_LIST SET PRIORITY = 450 WHERE TAXON_LIST_KEY = 'NHMSYS0020316085'
UPDATE TAXON_LIST SET PRIORITY = 8240 WHERE TAXON_LIST_KEY = 'NHMSYS0020417446'
UPDATE TAXON_LIST SET PRIORITY = 7000 WHERE TAXON_LIST_KEY = 'NHMSYS0020424779'
UPDATE TAXON_LIST SET PRIORITY = 4420 WHERE TAXON_LIST_KEY = 'NHMSYS0020468070'
UPDATE TAXON_LIST SET PRIORITY = 570 WHERE TAXON_LIST_KEY = 'NHMSYS0020476675'
UPDATE TAXON_LIST SET PRIORITY = 430 WHERE TAXON_LIST_KEY = 'NHMSYS0020503323'
UPDATE TAXON_LIST SET PRIORITY = 4440 WHERE TAXON_LIST_KEY = 'NHMSYS0020515439'
UPDATE TAXON_LIST SET PRIORITY = 8210 WHERE TAXON_LIST_KEY = 'NHMSYS0020516404'
UPDATE TAXON_LIST SET PRIORITY = 4450 WHERE TAXON_LIST_KEY = 'NHMSYS0020531282'
UPDATE TAXON_LIST SET PRIORITY = 6370 WHERE TAXON_LIST_KEY = 'NHMSYS0020546341'
UPDATE TAXON_LIST SET PRIORITY = 6360 WHERE TAXON_LIST_KEY = 'NHMSYS0020547816'
UPDATE TAXON_LIST SET PRIORITY = 6350 WHERE TAXON_LIST_KEY = 'NHMSYS0020561516'
UPDATE TAXON_LIST SET PRIORITY = 6340 WHERE TAXON_LIST_KEY = 'NHMSYS0020668227'
UPDATE TAXON_LIST SET PRIORITY = 720 WHERE TAXON_LIST_KEY = 'NHMSYS0020733605'
UPDATE TAXON_LIST SET PRIORITY = 4460 WHERE TAXON_LIST_KEY = 'NHMSYS0020735734'
UPDATE TAXON_LIST SET PRIORITY = 9997 WHERE TAXON_LIST_KEY = 'NHMSYS0020791186'
UPDATE TAXON_LIST SET PRIORITY = 195 WHERE TAXON_LIST_KEY = 'NHMSYS0020970930'
UPDATE TAXON_LIST SET PRIORITY = 6380 WHERE TAXON_LIST_KEY = 'NHMSYS0020974327'
UPDATE TAXON_LIST SET PRIORITY = 650 WHERE TAXON_LIST_KEY = 'NHMSYS0021013728'
UPDATE TAXON_LIST SET PRIORITY = 8450 WHERE TAXON_LIST_KEY = 'NHMSYS0021111265'
UPDATE TAXON_LIST SET PRIORITY = 770 WHERE TAXON_LIST_KEY = 'NHMSYS0021120134'
UPDATE TAXON_LIST SET PRIORITY = 2460 WHERE TAXON_LIST_KEY = 'NHMSYS0021120971'
UPDATE TAXON_LIST SET PRIORITY = 6390 WHERE TAXON_LIST_KEY = 'NHMSYS0021128600'
UPDATE TAXON_LIST SET PRIORITY = 330 WHERE TAXON_LIST_KEY = 'NHMSYS0021132351'
UPDATE TAXON_LIST SET PRIORITY = 4470 WHERE TAXON_LIST_KEY = 'NHMSYS0100000001'

GO

ALTER TABLE Index_Taxon_Name 
	ADD PREFERRED_TAXA  BIT NULL

GO

ALTER TABLE [dbo].[INDEX_TAXON_NAME] ADD  CONSTRAINT [DF_INDEX_TAXON_NAME_PREFERRED_TAXA]  DEFAULT ((0)) FOR [PREFERRED_TAXA]

GO

/****** Object:  StoredProcedure [dbo].[usp_Index_Taxon_Name_Preferred_Taxa]    Script Date: 09/09/2016 12:47:40 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


/*===========================================================================*\
  Description:	
			Procedure which populates the preferred taxa column 

  Created:	January 2016 Mike Weideli

  
   ===========================================================================*/
CREATE PROCEDURE [dbo].[usp_Index_Taxon_Name_Apply_Preferred_Taxa] 

AS

UPDATE INDEX_TAXON_NAME set preferred_taxa = 1
FROM 
  Index_taxon_name ITN INNER JOIN Taxon_List_Item TLi ON TLI.taxon_List_Item_Key
  = ITN.Taxon_List_Item_Key INNER JOIN TAXON_LIST_VERSION TLV ON TLV.Taxon_List_Version_Key 
  = TLi.TAXON_LIST_VERSION_KEY INNER JOIn Taxon_List TL ON TL.TAXON_LIST_KEY = TLV.TAXON_LIST_KEY
 INNER JOIN 
(SELECT   dbo.LCRemoveSubGenusText(ITN.ACTUAL_NAME) AS TAXON_NAME,
  ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY AS RTLIK,
  Min(TL.PRIORITY) AS MINPRIORITY  
  FROM INDEX_Taxon_name ITN
  INNER JOIN Taxon_List_Item TLI ON TLI.TAXON_LIST_ITEM_KEY =
  ITN.Taxon_List_Item_Key
  INNER JOIN TAXON_LIST_VERSION TLV ON TLV.TAXON_LIST_VERSION_KEY
  = TLI.TAXON_LIST_VERSION_KEY
  INNER JOIN Taxon_List TL ON TL.TAXON_LIST_KEY = TLV.TAXON_LIST_KEY
  GROUP BY dbo.LCRemoveSubGenusText(ITN.ACTUAL_NAME),ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY)
  AS D
  ON
  D.RTLIK = ITN.Recommended_Taxon_List_Item_Key
  AND D.MINPRIORITY = TL.Priority AND D.TAXON_NAME = dbo.LCRemoveSubGenusText(ITN.ACTUAL_NAME)
  WHERE 
     ITN.Allow_Data_Entry = 1 AND 
     TLI.Taxon_List_Version_To IS NULL 
     AND TLV.Version >= (SELECT MAX(Version)
			FROM Taxon_List_Version 
          	WHERE Taxon_List_Key = 
          	(SELECT Taxon_List_Key From Taxon_List_Version
          	 WHERE Taxon_List_Version_Key = TLV.Taxon_List_Version_Key)
           AND Version_Is_Amendment = 0)

Go

GRANT EXECUTE ON [dbo].[usp_Index_Taxon_Name_Apply_Preferred_Taxa] TO PUBLIC

GO


/****** Object:  StoredProcedure [dbo].[usp_IndexTaxonName_ApplyNameServer]    Script Date: 09/09/2016 12:55:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*===========================================================================*\
  Description: Applies the NameServer information to the Index_Taxon_Name
		Recommended_Taxon_List_Item_Key table.  Updates all records where this value
		is null.

  Parameters:	None

  Created:	November 2004

  Last revision September 2016 

\*=========================================================================== */
ALTER PROCEDURE [dbo].[usp_IndexTaxonName_ApplyNameServer]
AS
/* Remove any disconnected index_taxon_name records */
DELETE ITN 
FROM Index_Taxon_Name ITN
LEFT JOIN Taxon_List_Item TLI ON TLI.Taxon_List_Item_Key=ITN.Taxon_List_Item_Key
WHERE TLI.Taxon_List_Item_Key IS NULL

UPDATE ITN
SET ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = NS.RECOMMENDED_TAXON_LIST_ITEM_KEY
FROM NAMESERVER NS
INNER JOIN TAXON_LIST_ITEM TLI ON NS.INPUT_TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY
INNER JOIN INDEX_TAXON_NAME ITN ON ITN.TAXON_LIST_ITEM_KEY = TLI.TAXON_LIST_ITEM_KEY
WHERE ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY IS NULL 

UPDATE ITN
SET ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.PREFERRED_NAME
FROM TAXON_LIST TL 
INNER JOIN TAXON_LIST_VERSION TLV ON TL.TAXON_LIST_KEY = TLV.TAXON_LIST_KEY
INNER JOIN TAXON_LIST_ITEM TLI ON TLV.TAXON_LIST_VERSION_KEY = TLI.TAXON_LIST_VERSION_KEY
INNER JOIN TAXON_LIST_ITEM TLI1 ON TLI.TAXON_VERSION_KEY = TLI1.TAXON_VERSION_KEY
INNER JOIN INDEX_TAXON_NAME ITN ON TLI1.TAXON_LIST_ITEM_KEY = ITN.TAXON_LIST_ITEM_KEY
WHERE TL.PREFERRED=1 AND ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY IS NULL

UPDATE ITN
SET ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.PREFERRED_NAME
FROM TAXON_VERSION TV
INNER JOIN TAXON_LIST_ITEM TLI ON TV.TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY
INNER JOIN TAXON_GROUP TG ON TV.Output_group_key = TG.TAXON_GROUP_KEY
INNER JOIN TAXON_LIST_VERSION TLV ON TLV.TAXON_LIST_KEY=TG.USE_TAXON_LIST_KEY
		AND TLI.TAXON_LIST_VERSION_KEY=TLV.TAXON_LIST_VERSION_KEY
INNER JOIN TAXON_LIST_ITEM AS TLI1 
		ON TLI.TAXON_VERSION_KEY = TLI1.TAXON_VERSION_KEY
INNER JOIN INDEX_TAXON_NAME ITN ON TLI1.TAXON_LIST_ITEM_KEY = ITN.TAXON_LIST_ITEM_KEY
WHERE ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY IS NULL

UPDATE ITN
SET ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY = TLI.PREFERRED_NAME
FROM INDEX_TAXON_NAME ITN
INNER JOIN TAXON_LIST_ITEM TLI ON TLI.TAXON_LIST_ITEM_KEY=ITN.TAXON_LIST_ITEM_KEY
INNER JOIN TAXON_LIST_ITEM TLI2 on TLI2.TAXON_LIST_ITEM_KEY=TLI.PREFERRED_NAME
WHERE ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY IS NULL

--Now set up the recommended sort orders, which depend on the recommended names

UPDATE ITN
SET ITN.Sort_Order=
	LEFT('000', 3 - LEN(CONVERT(VARCHAR(3), ISNULL(TG.Sort_Order,0))))
  + CONVERT(VARCHAR(3), ISNULL(TG.Sort_Order,0)) 
	+ LEFT('00000000', 8 - LEN(CONVERT(VARCHAR(8), ISNULL(TLI.Sort_Code,0))))
  + CONVERT(VARCHAR(8), ISNULL(TLI.Sort_Code,0)) 
FROM Index_Taxon_Name ITN 
INNER JOIN Taxon_List_Item TLI ON TLI.Taxon_List_Item_Key=ITN.Recommended_Taxon_List_Item_Key
INNER JOIN Taxon_Version TV ON TV.Taxon_Version_Key=TLI.Taxon_Version_Key
LEFT JOIN Taxon_Group TG ON TG.Taxon_Group_Key=TV.Output_Group_Key

-- Set Can_Expand to True

Update Index_Taxon_Name set Can_Expand = 1

-- Poulate Can_Expand in ITN

EXECUTE [dbo].[usp_Populate_Can_Expand]

-- Rebuild the lineage and sort order on the Organism table

EXECUTE [dbo].[spPopulateOrganismLineage]


-- If there is anything in the Organism table and the Sort_Method not there or set to Recommended.

UPDATE Index_Taxon_Name 
  SET SORT_ORDER = ORG.SORT_ORDER
  FROM INDEX_TAXON_NAME ITN 
  INNER JOIN TAXON_LIST_ITEM TLI ON TLI.TAXON_LIST_ITEM_KEY = ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY
  INNER JOIN ORGANISM ORG ON ORG.TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY
  WHERE NOT EXISTS (SELECT * FROM SETTING WHERE [NAME]  = 'SortMethod' AND [DATA] = 'Recommended')

-- If there is anything in the Organism table then set the allow data entry based on redundant flag 

UPDATE Index_Taxon_Name 
Set Allow_Data_Entry = 1  
FROM INDEX_TAXON_NAME ITN 
INNER JOIN TAXON_LIST_ITEM TLI ON TLI.TAXON_LIST_ITEM_KEY = ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY
INNER JOIN ORGANISM ORG ON ORG.TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY
WHERE ITN.Allow_Data_Entry = 0 

UPDATE Index_Taxon_Name 
Set Allow_Data_Entry = 0  
FROM INDEX_TAXON_NAME ITN 
INNER JOIN TAXON_LIST_ITEM TLI ON TLI.TAXON_LIST_ITEM_KEY = ITN.RECOMMENDED_TAXON_LIST_ITEM_KEY
INNER JOIN ORGANISM ORG ON ORG.TAXON_VERSION_KEY = TLI.TAXON_VERSION_KEY
WHERE ORG.REDUNDANT_FLAG = 'Y' 

 
EXECUTE [dbo].[usp_Populate_Index_Taxon_Hierarchy]

EXECUTE [dbo].[usp_Index_Taxon_Name_Apply_Preferred_Taxa]




 